# シフト作成Webアプリケーション v2.0

各スタッフが個別に希望シフトを入力し、全員提出完了で自動的に最適化されたシフトを生成するWebアプリケーションです。

## 新バージョンの特徴

- **個別入力**: 各スタッフが自分のスマホ・PCから希望を入力
- **自動最適化**: 全員提出完了時に自動的にシフトを最適化
- **Excelベース**: データ管理はExcelファイルで実施（SQLite不要）
- **提出状況確認**: 管理者は誰が提出済みか一目で確認可能

## 必要な環境

- Python 3.8以上
- Webブラウザ（Chrome, Firefox, Edge等）
- 同一ネットワーク内で複数端末からアクセス可能

## インストール方法

### 1. 仮想環境の有効化（既に作成済みの場合）

```powershell
.venv\Scripts\activate
```

### 2. 必要なパッケージのインストール

```powershell
pip install -r requirements.txt
```

## 起動方法

```powershell
python app.py
```

起動すると以下のように表示されます：

```
============================================================
🚀 シフト作成Webアプリケーション v2.0
============================================================
📁 作業ディレクトリ: c:\Users\...\オルソフィット星田店様
📁 出力ディレクトリ: output/
🌐 ブラウザで http://localhost:5000 にアクセスしてください
============================================================
```

### 同じネットワーク内の他の端末からアクセス

1. サーバーPCのIPアドレスを確認（例: 192.168.1.100）
2. 他の端末のブラウザで `http://192.168.1.100:5000` にアクセス

## 使い方

### 【管理者】月次シフトの作成

1. トップページで「管理者」を選択
2. 「月次シフト作成」をクリック
3. スタッフ名を入力（5名程度）
4. 「シフトを作成」ボタンをクリック
5. 作成完了！

これにより、以下のファイルが生成されます：
```
output/
  └── 2024年11月/
      └── スタッフマスタ.xlsx
```

### 【スタッフ】希望シフトの入力

1. トップページで「スタッフ」を選択
2. 対象月を選択（例：2024年11月）
3. 自分の名前を選択
4. 各日の希望シフトを選択
   - **便利機能**: 「全日に適用」「平日に適用」「土日に適用」ボタンで一括設定可能
5. 「希望を提出する」ボタンをクリック
6. 提出完了！

提出すると、以下のファイルが生成されます：
```
output/
  └── 2024年11月/
      ├── スタッフマスタ.xlsx（提出状態が更新される）
      └── 希望_山田太郎.xlsx
```

### 【全員提出後】自動最適化

全員が提出完了すると、**自動的に**シフトが最適化されます！

最適化が完了すると：
```
output/
  └── 2024年11月/
      ├── スタッフマスタ.xlsx
      ├── 希望_山田太郎.xlsx
      ├── 希望_佐藤花子.xlsx
      ├── 希望_田中一郎.xlsx
      ├── 2024年11月.xlsx（統合された希望）
      └── 2024年11月_最適化シフト_完成版.xlsx ← これがダウンロード可能
```

### 【管理者】提出状況確認

1. トップページで「管理者」を選択
2. トップページに戻り、対象月を選択（または直接URLで `/admin/status/2024年11月`）
3. 提出状況一覧が表示されます
   - ✓ 提出済み
   - 未提出
4. 全員提出完了後、「シフトを最適化する」ボタンが表示されます
5. 最適化済みの場合は「最適化シフトをダウンロード」ボタンからダウンロード可能

## シフトの選択肢

- **早番**: 早番希望
- **中番**: 中番希望（※現在の最適化では「どちらでも」として扱われます）
- **遅番**: 遅番希望
- **休み**: 休み希望
- **有給**: 有給休暇
- **半休**: 半日休暇

## 最適化の制約条件

現在の最適化ロジックは以下の制約で動作しています：

1. **毎日の必要人数**: 早番・遅番ともに最低1名
2. **連続勤務制約**: 遅番→翌日早番の連続は禁止
3. **休日数**: 各スタッフ9〜11日（目標10日）
4. **希望の尊重**: できる限りスタッフの希望に沿ったシフトを生成

## ファイル構成

```
オルソフィット星田店様/
├── app.py                          # Flaskアプリケーション（新版）
├── excel_manager.py                # Excel管理モジュール（新規）
├── Shift_optimizer.py              # シフト最適化エンジン
├── requirements.txt                # 必要なパッケージ
├── README.md                       # このファイル
├── templates/                      # HTMLテンプレート
│   ├── home.html                  # トップページ
│   ├── result.html                # 結果表示
│   ├── admin/                     # 管理者画面
│   │   ├── menu.html             # 管理者メニュー
│   │   ├── create.html           # 月次シフト作成
│   │   └── status.html           # 提出状況確認
│   └── staff/                     # スタッフ画面
│       ├── select_month.html      # 月選択
│       ├── select_name.html       # 名前選択
│       ├── input.html             # 希望入力フォーム
│       └── submit_success.html    # 提出完了
├── static/                         # 静的ファイル
│   └── style.css                  # スタイルシート
└── output/                         # 出力ディレクトリ
    └── [年月]/
        ├── スタッフマスタ.xlsx
        ├── 希望_[名前].xlsx
        └── [年月]_最適化シフト_完成版.xlsx
```

## トラブルシューティング

### パッケージのインストールが失敗する

```powershell
# ortoolsのインストールに時間がかかる場合
pip install Flask pandas openpyxl numpy Werkzeug
pip install ortools  # 別途インストール
```

### ブラウザでアクセスできない

1. ファイアウォールの設定を確認
2. ポート5000が他のアプリケーションで使用されていないか確認
3. `app.py`の最後の行のポート番号を変更（例：5001）

### 最適化が失敗する

- スタッフ数が少なすぎる可能性（最低2名推奨）
- 希望が厳しすぎる可能性（全員が同じ日に休み希望など）

### Excelファイルが開けない

- ファイルが既に開かれている場合は閉じてください
- outputフォルダの書き込み権限を確認してください

## 今後の拡張予定

- **中番シフトの完全対応**: 3シフト制を4シフト制に拡張
- **制約条件のカスタマイズ**: 管理者画面から制約を設定可能に
- **通知機能**: 全員提出完了時にメール通知
- **過去シフトの参照**: 前月のシフトを参考に入力

## お問い合わせ

問題が発生した場合は、管理者にお問い合わせください。

---

**バージョン**: 2.0.0
**最終更新**: 2024年11月
**新機能**: 個別入力・自動最適化・Excel管理
